"use strict";(function(){function e(e){return k.findIndex(t=>t.name==e)}function t(e){var t=document.getElementById("game");b=e.scenes.length;var a=document.createElement("map");a.name="imgmap",a.id="imgmap",t.append(a);for(var l=0;l<b;l++)n(l,e.scenes[l])}function n(e,t){var n=document.getElementById("game");fetch("scenes/"+t+".json",{method:"GET"}).then(function(e){return e.json()}).then(function(l){var o=new Image;o.id=t,o.style.display="none",o.draggable=!1,o.useMap="#imgmap",o.oncontextmenu=function(){return!1},o.onload=function(){E++;var e=E/b*100;document.getElementById("loadingBar").style.width=e+"%",document.getElementById("loadingTxt").innerText="Loading ("+Math.floor(e)+"%)",E>=b&&a()},o.src=l.image,n.append(o);var i=new f(e,t,l.hotspots);null!=l.timeout&&(i.timeout=l.timeout),null!=l.functions&&(i.functions=l.functions),k.push(i)})}function a(){if(null!=localStorage.getItem(g)){var e=localStorage.getItem(g).split("\n");B=parseInt(e[0]),v=JSON.parse(e[1])}k.sort((e,t)=>e.idx-t.idx),document.getElementById("loading").remove(),l(),null!=document.getElementById("reset")&&(document.getElementById("reset").onclick=function(){M||1==confirm("You're about to reset the game. Are you sure?")&&(I=null,w=0,y(),v={},localStorage.clear(),document.getElementById(k[B].name).style.display="none",B=0,l())})}function l(){var e=k[B];document.getElementById(e.name).style.display="block";var t=e.hotspots,n=document.getElementsByTagName("map")[0];n.innerHTML="";var a=!1;if(t.length>0){for(var l=0;l<t.length;l++){var o=function(e){var t=document.createElement("area");t.shape=e[0],t.coords=e[1],c(t,e[2]),n.appendChild(t)},r=t[l].trim().match(/if (.*) {(.*)}/);if(null!=r){var s=r[1].trim(),u=r[2].trim();("!"!=s[0]||null!=v[s]&&0!=v[s])&&1!=v[s]||o(u.trim().split("|"))}else o(t[l].trim().split("|"))}a=!0}else{var m=document.createElement("area");m.shape="rect",m.coords="0, 0, "+T+", "+_,m.style.cursor="progress",n.appendChild(m),a=!1}if(null!=e.timeout){var y=e.timeout.split("|");w=parseInt(y[0]);var p=y[1].split("=");I=function(){d(p)},"go"==p[0].trim()&&(a=!1)}i(!a)}function o(){fetch("settings.json",{method:"GET"}).then(function(e){return e.json()}).then(function(e){T=parseInt(e.resolution.width),_=parseInt(e.resolution.height),S=parseFloat(e.transitionTime.fade),F=parseFloat(e.transitionTime.move),e.others.enableSave?(document.getElementById("reset").style.display="block",i(!0)):(localStorage.clear(),document.getElementById("reset").remove()),t(e)})}function i(e){null!=document.getElementById("reset")&&(M=e,document.getElementById("reset").style.opacity=e?.1:.5,M||r())}function r(){var e=B.toString();e+="\n"+JSON.stringify(v),localStorage.setItem(g,e)}function s(t,n){y(),i(!0);var a=document.getElementById(k[B].name);switch(t){case"prev":B--,t=k[B].name;break;case"next":B++,t=k[B].name;break;default:B=e(t)}var o=document.getElementById(t);o.style.display="block";var r=document.getElementsByTagName("map")[0];r.innerHTML="",a.style.zIndex=0,o.style.zIndex=1;var s=function(){o.style.opacity=1,a.style.display="none",a.style.opacity=1,l()};switch(n){case"fadeinout":(new TimelineMax).to(a,S,{opacity:0,y:0,x:0}).from(o,S,{opacity:0,y:0,x:0}).addCallback(s,"+=0");break;case"fade":(new TimelineMax).from(o,S,{opacity:0,y:0,x:0}).addCallback(s,"+=0");break;case"slide_left":case"slide_right":var c=T*("slide_right"==n?-1:1),d=-T*("slide_right"==n?-1:1);(new TimelineMax).addLabel("t").to(a,F,{opacity:1,x:c,y:0,ease:Power1.easeInOut},"t+=0").from(o,F,{opacity:1,x:d,y:0,ease:Power1.easeInOut},"t+=0").to(a,0,{opacity:1,x:0,y:0}).addCallback(s,"+=0");break;case"slide_up":case"slide_down":var u=_*("slide_up"==n?-1:1),m=-_*("slide_up"==n?-1:1);(new TimelineMax).addLabel("t").to(a,F,{opacity:1,y:u,x:0,ease:Power1.easeInOut},"t+=0").from(o,F,{opacity:1,y:m,x:0,ease:Power1.easeInOut},"t+=0").to(a,0,{opacity:1,x:0,y:0}).addCallback(s,"+=0");break;case"slideover_left":case"slideover_right":(new TimelineMax).addLabel("t").from(o,F,{opacity:1,x:-T*("slideover_right"==n?-1:1),y:0,ease:Power2.easeOut},"t+=0").to(a,0,{opacity:1,x:0,y:0}).addCallback(s,"+=0");break;case"slideover_up":case"slideover_down":(new TimelineMax).addLabel("t").from(o,F,{opacity:1,y:-_*("slideover_up"==n?-1:1),x:0,ease:Power2.easeOut},"t+=0").to(a,0,{opacity:1,x:0,y:0}).addCallback(s,"+=0");break;case"slidereveal_left":case"slidereveal_right":a.style.zIndex=1,o.style.zIndex=0,(new TimelineMax).to(a,F,{opacity:1,y:0,x:T*("slidereveal_left"==n?-1:1),ease:Power2.easeIn}).to(a,0,{opacity:1,x:0,y:0}).addCallback(s,"+=0");break;case"slidereveal_up":case"slidereveal_down":a.style.zIndex=1,o.style.zIndex=0,(new TimelineMax).to(a,F,{opacity:1,x:0,y:_*("slidereveal_up"==n?-1:1),ease:Power2.easeIn}).to(a,0,{opacity:1,x:0,y:0}).addCallback(s,"+=0");break;default:s()}}function c(e,t){e.onmousedown=function(){d(t.trim().split("="))}}function d(e){switch(e[0]){case"go":null!=I&&(w=0,I=null),s(m(e[1]),e[2]);break;case"text":document.getElementById("text").innerText=m(e[1]),document.getElementById("textFrame").style.display="block",x=3e3;break;default:k[B].functions[e[0]].split(";").forEach(e=>{u(e)})}}function u(e){var t="";if(t=e.match(/set (.*) = (.*)/),null==t)if(t=e.match(/if (.*) {(.*)} else {(.*)}/),null==t){var n=e.trim().split("=");n.length>0&&d(n)}else{o=t[1].trim();var a=t[2].trim(),l=t[3].trim();null==v[o]||0==v[o]?d(l.split("=")):1==v[o]&&d(a.split("="))}else{var o=t[1].trim(),i=t[2].trim();"true"==i.toLowerCase()||"false"==i.toLowerCase()?v[o]="true"==i:v[o]=i}}function m(e){var t="";if(t=e.match(/choose{(.*)}/),null!=t){var n=t[1].split(";");return n[Math.floor(Math.random()*n.length)].trim()}if(t=e.match(/{(.+?)}/),null!=t)try{return v[t[1].trim()]}catch(e){console.error("Variable "+t[1]+" is null!"),console.error(e)}return e.trim()}function y(){document.getElementById("textFrame").style.display="none",x=0}function p(){var e=Date.now();L=e-C,C=e,x>0&&(x-=L,x<1&&y()),null!=I&&w>0&&(w-=L,w<1&&(w=0,I(),I=null));var t=T/_,n=window.innerWidth,a=window.innerHeight,l=n/a,o=(n-T)/2,i=(a-_)/2,r=n/T,s=a/_,c=document.getElementById("game").style;switch(c.width=T+"px",c.height=_+"px",c.marginTop=i+"px",c.marginLeft=o+"px",c.scale=l>t?s:r,h){case-1:h=0}window.scroll(0,0)}var f=function(e,t,n){this.idx=e,this.name=t,this.hotspots=n,this.timeout=void 0,this.functions={}};const g="SAVEDATA";var h=-1,v={},x=0,w=0,I=null,b=0,E=0,k=[],B=0,T=0,_=0,M=!1,S=0,F=0,C=Date.now(),L=0;document.getElementById("reset").style.display="none",document.getElementById("textFrame").style.display="none",setInterval(p,1),o(),document.body.oncontextmenu=function(){return!1},document.oncontextmenu=function(){return!1},document.getElementById("fullscreen").onmousedown=function(){if(-1!=h)try{var e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen(),screen.orientation.lock("landscape")}catch(e){}},window.addEventListener("fullscreenchange",function(){h=0==h?1:0,document.getElementById("fullscreen").style.display=1==h?"none":"block"}),window.zoom=1})();